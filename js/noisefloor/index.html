<head>
    <head>
        <style>
            body { margin-top: 40px; }

            rect { shape-rendering: crispEdges; }
            .key-white { stroke: black; fill: white; }
            .key-white.depressed { fill: lightcyan;}
            .key-black { stroke: black; fill: black; }
            .key-black.depressed { fill: darkslategray; }
        </style>
    </head>
</head>
<body>
    <!-- <body>
        <script src="http://unpkg.com/react@15/dist/react.min.js"></script>
        <script src="http://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
        <script src="noisefloor.js"></script>
        <script type="text/javascript">
            o = MakeProcessor('Oscillator');
            console.log(o)
            o.Start(100);
            o.Freq = 1;

            for (i = 0; i < 100; i++) {
                console.log(o.Process())
            }
            console.log(o);
        </script>
    </body> -->

    <div id="keyboard"></div>
    <body>
        <svg id="react" class="container" style="width:100%;height:100%;position:fixed;top:0;left:0;bottom:0;right:0;">
        </svg>
        <script src="http://unpkg.com/react@15/dist/react.min.js"></script>
        <script src="http://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
        <script src="noisefloor.js"></script>
    </body>
    <script type="text/javascript">
        var audioContext = new AudioContext();

        // One-liner to resume playback when user interacted with the page.
        document.getElementById('react').addEventListener('click', function() {
          audioContext.resume().then(() => {
            console.log('Playback resumed successfully');
          });
        });

        var frameLength  = 4096
        var sampleBuffer = [
            new Float32Array(Array(frameLength).fill(0)),
            new Float32Array(Array(frameLength).fill(0))
            ];

        // var audioContext = new AudioContext();

        noisefloorjs.start(audioContext.sampleRate);

        var node = audioContext.createScriptProcessor(frameLength, 2, 2);
        node.onaudioprocess = function (event) {
            var output = event.outputBuffer.getChannelData(0);
            var midiIn = noisefloorjs.getMIDIEvents();

            noisefloorjs.process(sampleBuffer, sampleBuffer, midiIn, midiIn);
            event.outputBuffer.copyToChannel(sampleBuffer[0], 0);
            event.outputBuffer.copyToChannel(sampleBuffer[1], 1);
        }
        node.connect(audioContext.destination);

        console.log('Running process');
    </script>
</body>
